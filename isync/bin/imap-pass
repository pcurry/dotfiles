#!/usr/bin/env python
# -*- coding: utf-8; -*-

from __future__ import print_function

import sys
from getpass import getpass
from argparse import ArgumentParser

import keyring


def get_password(username):
    service = 'IMAP ' + username.split('@')[1]
    password = keyring.get_password(service, username)
    if not password:
        password = getpass('Password for {0}: '.format(username))
        keyring.set_password(service, username, password)
    return password


def main():
    parser = ArgumentParser(description='Get an IMAP password')
    parser.add_argument('username', help='The name of the user')

    args = parser.parse_args()
    print(get_password(args.username))
    return 0


if __name__ == '__main__':
    sys.exit(main())
